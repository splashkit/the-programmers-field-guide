---
title: Potentiometer-Servo Explorer
sidebar:
  attrs:
    class: pi
  label: " - Potentiometer↔Servo Explorer"
---

import { Steps } from '@astrojs/starlight/components';

Create a small program that reads a potentiometer value, converts it into a servo angle, drives the servo, and logs each step in a typed struct array. You’ll practice both **enums** and **structs** in a simple hardware context.

Use:
- An **enum** to name three preset positions (`Zero`, `Ninety`, `OneEighty`)  
- A **struct** to hold each record: the enum label, the raw ADC reading, and the computed angle  

## What to Build

<Steps>
1. **Type Definitions**  
   - Declare your enum:  
     ```cpp
     enum ServoPosition { Zero, Ninety, OneEighty };
     ```  
   - Declare your struct:  
     ```cpp
     struct Mapping {
       ServoPosition pos;  // which preset (nearest) angle
       int raw_adc;        // raw ADC reading (0–255)
       int angle;          // converted angle (0–180)
     };
     ```

2. **Helper Functions**  
   - `nearest_position(int angle)` → returns the closest `ServoPosition`  
   - `pos_to_string(ServoPosition p)` → returns `"Zero"`, `"Ninety"`, or `"OneEighty"`

3. **Initialization**  
   - Call `raspi_init()`  
   - Open your ADS7830 ADC with `open_adc("pot", ADS7830)`  
   - Open your servo pin (e.g. `open_servo("servo", PIN_12)`)

4. **Phase 1: Pot → Servo**  
   - **Reading 1**:  
     1. `write_line("Turn pot & press Enter for reading 1.");`  
     2. `read_line();`  
     3. `raw = read_adc(pot, ADC_PIN_0);`  
     4. `angle = raw * 180 / 255;`  
     5. `set_servo_angle(servo, float(angle));`  
     6. `mappings[0] = { nearest_position(angle), raw, angle };`  
   - **Reading 2 & 3**: Repeat the same steps, storing into `mappings[1]` and `mappings[2]`.

5. **Report**  
   - Manually print three rows—no loops—using `write_line`:  
     ```
     Position   | Raw ADC | Angle
     Zero       |   123   |   0°
     Ninety     |   200   |  90°
     OneEighty  |    50   | 180°
     ```

6. **Cleanup**  
   - `close_adc(pot);`  
   - `stop_servo(servo);`  
   - `close_all_servos();`  
   - `close_all_windows();`  
   - `raspi_cleanup();`

</Steps>

:::caution
Avoid using any `for` or `while` loops to fill or print your `mappings` array—index each entry by hand to reinforce the enum and struct practice.
:::

:::tip
Keep your `main()` body clear by offloading logic into small helpers (`nearest_position`, `pos_to_string`). This makes the flow of “read → convert → move → record” very transparent.
:::